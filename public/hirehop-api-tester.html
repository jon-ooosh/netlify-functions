<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HireHop API Tester</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select, button {
      padding: 8px;
      font-size: 16px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    #result {
      margin-top: 20px;
      border: 1px solid #ddd;
      padding: 15px;
      background-color: #f9f9f9;
      overflow-x: auto;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1>HireHop API Endpoint Tester</h1>
  <p>Use this tool to test different HireHop API endpoints and see the responses.</p>
  
  <div class="form-group">
    <label for="jobId">Job ID:</label>
    <input type="text" id="jobId" placeholder="Enter job ID">
  </div>
  
  <div class="form-group">
    <label for="endpoint">Endpoint to Test:</label>
    <select id="endpoint">
      <option value="job_data">Job Data (/api/job_data.php)</option>
      <option value="job_margins">Financial Data (/php_functions/job_margins.php)</option>
      <option value="items_list">Items List (/frames/items_to_supply_list.php)</option>
      <option value="payment_receipts">Payment Receipts (/frames/payment_receipts_list.php)</option>
      <option value="billing_list">Billing List (/frames/billing_list.php)</option>
      <option value="billing_grid">Billing Grid (/frames/grids/billing_grid.php)</option>
      <option value="billing_api">üéØ Billing API (/php_functions/billing_list.php) - PAYMENTS & DEPOSITS</option>
      <option value="get_job_details_v2">üéØ NEW: Get Job Details v2 (with VAT & Excess Detection)</option>
      <option value="test_stripe_session">üéØ Test Stripe Session Creation</option>
      <option value="test_van_detection">üöê Test Van Detection (Debug van on hire detection)</option>
       <option value="find_deposit_endpoints">Searching... find deposit endpoints</option>
       <option value="test_deposit_creation">This is the one! Test deposit endpoints</option>
          </select>
  </div>
  
  <button id="testButton" onclick="testEndpoint()">Test Endpoint</button>
  
  <div id="result" style="display: none;">
    <h2>Result</h2>
    <div>
      <strong>URL:</strong> <span id="resultUrl"></span>
    </div>
    <div>
      <strong>Status Code:</strong> <span id="resultStatus"></span>
    </div>
    <div>
      <strong>Content Type:</strong> <span id="resultContentType"></span>
    </div>
    <div>
      <strong>Response Size:</strong> <span id="resultSize"></span> characters
    </div>
    <h3>Response:</h3>
    <pre id="resultResponse"></pre>
    <h3>Raw Response (first 1000 chars):</h3>
    <pre id="resultRaw"></pre>
  </div>
  
  <script>
    async function testEndpoint() {
      // Get input values
      const jobId = document.getElementById('jobId').value;
      const endpoint = document.getElementById('endpoint').value;
      
      if (!jobId) {
        alert('Please enter a job ID');
        return;
      }
      
      // Show loading state
      const button = document.getElementById('testButton');
      button.innerHTML = 'Testing...<div class="loading"></div>';
      button.disabled = true;
      document.getElementById('result').style.display = 'none';
      
      try {
        // Call the API
        const response = await fetch(`/.netlify/functions/test-hirehop-api?jobId=${jobId}&endpoint=${endpoint}`);
        const data = await response.json();
        
        // Update the result section
        document.getElementById('resultUrl').textContent = data.url;
        document.getElementById('resultStatus').textContent = data.statusCode;
        document.getElementById('resultContentType').textContent = data.contentType;
        document.getElementById('resultSize').textContent = data.responseSize;
        
        // Format and display the response
        document.getElementById('resultResponse').textContent = 
          typeof data.response === 'object' ? JSON.stringify(data.response, null, 2) : data.response;
        
        document.getElementById('resultRaw').textContent = data.rawResponse;
        
        // Show the result section
        document.getElementById('result').style.display = 'block';
      } catch (error) {
        alert('Error testing endpoint: ' + error.message);
        console.error('Error:', error);
      } finally {
        // Reset button state
        button.innerHTML = 'Test Endpoint';
        button.disabled = false;
      }
    }
  </script>
</body>
</html>
